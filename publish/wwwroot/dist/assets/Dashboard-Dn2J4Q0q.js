import{_ as b,c as o,o as n,a as e,b as g,t as i,F as c,r as u,n as m,d,e as h}from"./index-DfLkNCfm.js";const p={name:"Siparislerim",data(){return{orders:[],currentPage:0,pageSize:10,totalOrders:0,isLoading:!1,showModal:!1,selectedOrder:null,bayiId:localStorage.getItem("bayi_id")}},computed:{totalPages(){return Math.ceil(this.totalOrders/this.pageSize)},totalAmount(){return this.orders.reduce((s,t)=>s+(t.summary?.total||0),0)}},methods:{async fetchOrders(){try{this.isLoading=!0;const s=await h.get(`http://localhost:5079/api/siparisler/by-user/${this.bayiId}?page=${this.currentPage}&pageSize=${this.pageSize}`);if(this.orders=s.data,this.totalOrders===0){const t=await h.get(`http://localhost:5079/api/siparisler/by-user/${this.bayiId}/count`);this.totalOrders=t.data}}catch(s){console.error("Siparişler alınamadı:",s)}finally{this.isLoading=!1}},async fetchOrdersOnly(){try{this.isLoading=!0;const s=await h.get(`http://localhost:5079/api/siparisler/by-user/${this.bayiId}?page=${this.currentPage}&pageSize=${this.pageSize}`);this.orders=s.data}catch(s){console.error("Siparişler alınamadı:",s)}finally{this.isLoading=!1}},goToPage(s){s<0||s>=this.totalPages||(this.currentPage=s,this.fetchOrdersOnly())},formatDate(s){if(!s)return"";const t=new Date(s);return t.toLocaleDateString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit"})+" "+t.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})},formatCurrency(s){return s==null||isNaN(s)?"0,00 ₺":new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:2,maximumFractionDigits:2}).format(s)},openModal(s){this.selectedOrder=s,this.showModal=!0},closeModal(){this.showModal=!1,this.selectedOrder=null}},mounted(){this.fetchOrders()}},f={class:"dashboard-container p-4"},v={class:"summary-cards mb-4 d-flex flex-wrap gap-3"},_={class:"card bg-primary text-white p-3 rounded shadow",style:{"min-width":"180px"}},k={class:"fs-3"},w={class:"card bg-success text-white p-3 rounded shadow",style:{"min-width":"180px"}},x={class:"fs-3"},O={key:0,class:"d-flex justify-content-center align-items-center py-5"},T={key:1},S={class:"table-responsive rounded shadow"},P={class:"table table-bordered table-hover"},C={class:"font-monospace"},D={class:"fw-semibold"},M=["onClick"],L={class:"d-flex justify-content-center mt-3"},N={class:"pagination"},z=["onClick"],I={key:2,class:"modal fade show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.4)"}},F={class:"modal-dialog modal-lg modal-dialog-centered"},R={class:"modal-content"},A={class:"modal-header"},B={key:0,class:"modal-body"};function V(s,t,j,Y,a,l){return n(),o("div",f,[t[12]||(t[12]=e("h1",{class:"text-2xl font-bold mb-4"},"Siparişlerim",-1)),e("div",v,[e("div",_,[t[3]||(t[3]=e("div",{class:"text-lg fw-semibold"},"Toplam Sipariş",-1)),e("div",k,i(a.totalOrders),1)]),e("div",w,[t[4]||(t[4]=e("div",{class:"text-lg fw-semibold"},"Toplam Tutar",-1)),e("div",x,i(l.formatCurrency(l.totalAmount)),1)])]),a.isLoading?(n(),o("div",O,[...t[5]||(t[5]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Yükleniyor...")],-1),e("span",{class:"ms-2 fw-semibold"},"Siparişler yükleniyor...",-1)])])):(n(),o("div",T,[e("div",S,[e("table",P,[t[6]||(t[6]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Sipariş No"),e("th",null,"Toplam Tutar"),e("th",null,"Tarih"),e("th",null,"Detay")])],-1)),e("tbody",null,[(n(!0),o(c,null,u(a.orders,r=>(n(),o("tr",{key:r.order.id},[e("td",C,i(r.order.code),1),e("td",D,i(l.formatCurrency(r.summary.total)),1),e("td",null,i(l.formatDate(r.order.createdAt)),1),e("td",null,[e("button",{class:"btn btn-sm btn-info",onClick:y=>l.openModal(r)},"Detay",8,M)])]))),128))])])]),e("nav",L,[e("ul",N,[e("li",{class:m(["page-item",a.currentPage===0?"disabled":""])},[e("button",{class:"page-link",onClick:t[0]||(t[0]=r=>l.goToPage(a.currentPage-1))},"«")],2),(n(!0),o(c,null,u(l.totalPages,r=>(n(),o("li",{key:r,class:m(["page-item",a.currentPage===r-1?"active":""])},[e("button",{class:"page-link",onClick:y=>l.goToPage(r-1)},i(r),9,z)],2))),128)),e("li",{class:m(["page-item",a.currentPage===l.totalPages-1?"disabled":""])},[e("button",{class:"page-link",onClick:t[1]||(t[1]=r=>l.goToPage(a.currentPage+1))},"»")],2)])])])),a.showModal?(n(),o("div",I,[e("div",F,[e("div",R,[e("div",A,[t[7]||(t[7]=e("h5",{class:"modal-title"},"Sipariş Detayı",-1)),e("button",{type:"button",class:"btn-close",onClick:t[2]||(t[2]=(...r)=>l.closeModal&&l.closeModal(...r))})]),a.selectedOrder?(n(),o("div",B,[e("p",null,[t[8]||(t[8]=e("b",null,"Sipariş No:",-1)),d(" "+i(a.selectedOrder.order.code),1)]),e("p",null,[t[9]||(t[9]=e("b",null,"Tarih:",-1)),d(" "+i(l.formatDate(a.selectedOrder.order.createdAt)),1)]),e("p",null,[t[10]||(t[10]=e("b",null,"Toplam Tutar:",-1)),d(" "+i(l.formatCurrency(a.selectedOrder.summary.total)),1)]),t[11]||(t[11]=e("p",null,[e("b",null,"Ürünler:")],-1)),e("ul",null,[(n(!0),o(c,null,u(a.selectedOrder.products,r=>(n(),o("li",{key:r.code},[e("b",null,i(r.name),1),d(" (x"+i(r.quantity)+") - "+i(l.formatCurrency(r.price)),1)]))),128))])])):g("",!0)])])])):g("",!0)])}const E=b(p,[["render",V]]);export{E as default};
