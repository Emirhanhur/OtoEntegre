import{_ as b,c as d,o as c,a,b as m,t as h,b1 as w,j as u,b0 as f,d as p,i as y,w as k,f as v,e as _}from"./index-DfLkNCfm.js";class l extends Error{}l.prototype.name="InvalidTokenError";function I(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,r)=>{let s=r.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function x(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return I(e)}catch{return atob(e)}}function S(t,e){if(typeof t!="string")throw new l("Invalid token specified: must be a string");e||(e={});const r=e.header===!0?0:1,s=t.split(".")[r];if(typeof s!="string")throw new l(`Invalid token specified: missing part #${r+1}`);let o;try{o=x(s)}catch(i){throw new l(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(o)}catch(i){throw new l(`Invalid token specified: invalid json for part #${r+1} (${i.message})`)}}const E={data(){return{email:"",password:"",error:"",loading:!1}},methods:{async login(){this.error="";try{const t=await _.post("http://localhost:5079/api/auth/login",{email:this.email,password:this.password}),e=t.data.token;localStorage.setItem("token",e),console.log("response",t.data.user.tedarik_Kullanici_Id),localStorage.setItem("bayi_id",t.data.user.tedarik_Kullanici_Id),localStorage.setItem("kullanici_id",t.data.user.id);const r=S(e),s=r.role??r["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"];console.log("Kullanıcı rolü:",s),localStorage.setItem("rol",s),this.$router.push("/dashboard")}catch(t){t.response&&t.response.status===401?this.error="Email veya şifre yanlış!":this.error="Sunucu hatası, lütfen tekrar deneyin."}}}},C={class:"d-flex justify-content-center align-items-center vh-100 bg-light"},U={class:"card p-4 shadow-sm",style:{width:"400px"}},V={key:0,class:"alert alert-danger"},D={class:"mb-3"},N={class:"mb-3"},j=["disabled"],K={key:0,class:"spinner-border spinner-border-sm me-2"},T={class:"text-center mt-3 text-muted"};function B(t,e,r,s,o,i){const g=v("router-link");return c(),d("div",C,[a("div",U,[e[8]||(e[8]=a("h3",{class:"card-title text-center mb-4"},"Giriş Yap",-1)),o.error?(c(),d("div",V,h(o.error),1)):m("",!0),a("form",{onSubmit:e[2]||(e[2]=w((...n)=>i.login&&i.login(...n),["prevent"]))},[a("div",D,[e[3]||(e[3]=a("label",{for:"email",class:"form-label"},"Email",-1)),u(a("input",{type:"email",id:"email",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=n=>o.email=n),required:""},null,512),[[f,o.email]])]),a("div",N,[e[4]||(e[4]=a("label",{for:"password",class:"form-label"},"Şifre",-1)),u(a("input",{type:"password",id:"password",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=n=>o.password=n),required:""},null,512),[[f,o.password]])]),a("button",{type:"submit",class:"btn btn-primary w-100",disabled:o.loading},[o.loading?(c(),d("span",K)):m("",!0),e[5]||(e[5]=p(" Giriş ",-1))],8,j)],32),a("p",T,[e[7]||(e[7]=p(" Hesabınız yok mu? ",-1)),y(g,{to:"/pages/register"},{default:k(()=>[...e[6]||(e[6]=[p("Kayıt Ol",-1)])]),_:1})])])])}const G=b(E,[["render",B],["__scopeId","data-v-be10e0cf"]]);export{G as default};
