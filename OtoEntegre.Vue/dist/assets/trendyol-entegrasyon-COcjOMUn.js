import{f as v}from"./format-nzxwg-s_.js";import{M as P}from"./bootstrap.esm-CQSEgM1I.js";import{_ as E,g as h,c as n,b as t,a as b,j as f,v as C,F as p,r as y,d as g,t as i,n as S,o,e as D,k as T,f as x,l as L,m as O}from"./index-BFPoeHg0.js";const M={name:"SiparisDetayModal",props:{order:Object},data(){return{selectedCargo:"",isLoading:!1,cargoOptions:[{value:"YKMP",label:"Yurtiçi Kargo"},{value:"ARASMP",label:"Aras Kargo"},{value:"SURATMP",label:"Sürat Kargo"},{value:"HOROZMP",label:"Horoz Lojistik"},{value:"DHLECOMMP",label:"DHL"},{value:"PTTMP",label:"PTT"},{value:"CEVAMP",label:"Ceva"},{value:"TEXMP",label:"Trendyol Express"},{value:"KOLAYGELSINMP",label:"Kolay Gelsin"}],SiparistekiUrunler:[]}},methods:{async getProduct(){console.log("siparişteki ürünler",this.order.id);try{this.isLoading=!0;let s=`/api/Siparisler/${this.order.id}/urunler`;const e=await h.get(s);this.SiparistekiUrunler=e.data.urunler}catch(s){console.error("ürünler yüklenemedi",s)}finally{this.isLoading=!1}},showModal(){new P(this.$refs.modal).show(),this.getProduct()},formatMoney(s){return v(s,"TRY")},formatOrderDate(s){return new Date(s).toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},statusClass(s){switch(s){case"DELIVERED":return"bg-success text-white";case"CANCELLED":return"bg-danger text-white";case"SHIPPED":return"bg-primary text-white";case"CREATED":return"bg-warning text-dark";default:return"bg-secondary text-white"}},async changeCargoProvider(){if(console.log(this.order),!this.selectedCargo){this.$toast?.error("Lütfen kargo firması seçin!");return}this.isLoading=!0;try{await h.put(`/api/Siparisler/siparisler/${this.order.paketNumarasi}/kargo-firmasi`,{cargoProvider:this.selectedCargo,entegrasyonId:this.order.entegrasyonId}),this.$toast?.success("Kargo firması başarıyla değiştirildi!")}catch(s){console.error(s),this.$toast?.error("Kargo firması değiştirilemedi!")}finally{this.isLoading=!1}}},computed:{platformUrunKodlar(){return this.order?.platformUrunKod?.split(",")||[]},trendyolKodlar(){return this.order?.urunTrendyolKod?.split(",")||[]}},created(){}},A={class:"modal fade",ref:"modal"},I={class:"modal-dialog modal-lg modal-dialog-centered"},N={class:"modal-content"},w={key:0,class:"modal-body"},K={class:"mb-3"},R={class:"input-group"},U=["value"],V=["disabled"],_={key:0,class:"spinner-border spinner-border-sm me-2"},H={class:"row mb-3"},G={class:"col-md-6"},z={class:"col-md-6"},F={class:"p-2 border rounded",style:{"max-height":"100px","overflow-y":"auto"}},j={class:"table table-sm table-bordered"},B=["src"];function Y(s,e,a,m,r,d){return o(),n("div",A,[t("div",I,[t("div",N,[e[20]||(e[20]=t("div",{class:"modal-header bg-primary text-white"},[t("h5",{class:"modal-title"},"Sipariş Detayı"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),a.order?(o(),n("div",w,[t("div",K,[e[4]||(e[4]=t("label",{class:"form-label fw-bold"},"Kargo Firması",-1)),t("div",R,[f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=u=>r.selectedCargo=u),class:"form-select"},[e[2]||(e[2]=t("option",{disabled:"",value:""},"Seçiniz...",-1)),(o(!0),n(p,null,y(r.cargoOptions,u=>(o(),n("option",{key:u.value,value:u.value},i(u.label),9,U))),128))],512),[[C,r.selectedCargo]]),t("button",{class:"btn btn-outline-primary d-flex align-items-center",onClick:e[1]||(e[1]=(...u)=>d.changeCargoProvider&&d.changeCargoProvider(...u)),disabled:r.isLoading},[r.isLoading?(o(),n("span",_)):b("",!0),e[3]||(e[3]=g(" Değiştir ",-1))],8,V)])]),t("div",H,[t("div",G,[e[12]||(e[12]=t("h5",null,"Sipariş Bilgileri",-1)),t("p",null,[e[5]||(e[5]=t("strong",null,"Sipariş No:",-1)),g(" "+i(a.order.siparisNumarasi),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"Durum:",-1)),t("span",{class:S(["badge",d.statusClass(a.order.originalStatus)])},i(a.order.durum),3)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Toplam Tutar:",-1)),g(" "+i(d.formatMoney(a.order.toplamTutar)),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Kargo Firması:",-1)),g(" "+i(a.order.cargoProviderName),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Kargo Ücreti:",-1)),g(" "+i(d.formatMoney(a.order.kargoUcreti)),1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"Kargo Takip No:",-1)),g(" "+i(a.order.kargoTakipNumarasi),1)]),t("p",null,[e[11]||(e[11]=t("strong",null,"Paket No:",-1)),g(" "+i(a.order.paketNumarasi),1)])]),t("div",z,[e[16]||(e[16]=t("h5",null,"Müşteri Bilgileri",-1)),t("p",null,[e[13]||(e[13]=t("strong",null,"Ad Soyad:",-1)),g(" "+i(a.order.musteriAdSoyad),1)]),e[17]||(e[17]=t("p",null,[t("strong",null,"Adres:")],-1)),t("div",F,i(a.order.musteriAdres),1),t("p",null,[e[14]||(e[14]=t("strong",null,"Beden:",-1)),g(" "+i(a.order.beden||"-"),1)]),t("p",null,[e[15]||(e[15]=t("strong",null,"Renk:",-1)),g(" "+i(a.order.renk||"-"),1)])])]),e[19]||(e[19]=t("h6",null,"Ürün Bilgileri",-1)),t("table",j,[e[18]||(e[18]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Ürün Resmi"),t("th",null,"Ürün Adı"),t("th",null,"Adet"),t("th",null,"Trendyol Kod")])],-1)),t("tbody",null,[(o(!0),n(p,null,y(r.SiparistekiUrunler,(u,l)=>(o(),n("tr",{key:l},[t("td",null,[u.image?(o(),n("img",{key:0,src:u.image,alt:"",style:{"max-width":"100px","max-height":"100px"}},null,8,B)):b("",!0)]),t("td",null,i(u.ad),1),t("td",null,i(u.adet),1),t("td",null,i(u.productCode),1)]))),128))])])])):b("",!0),e[21]||(e[21]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Kapat")],-1))])])],512)}const Q=E(M,[["render",Y]]),W={components:{SiparisDetayModal:Q},data(){return{orders:[],selectedStatus:null,currentPage:1,pageSize:10,isLoading:!1,selectedOrders:[],selectedOrder:null,searchQuery:"",selectedShippingCompany:"",successMessage:"",cargoOptions:[{value:"YKMP",label:"Yurtiçi Kargo"},{value:"ARASMP",label:"Aras Kargo"},{value:"SURATMP",label:"Sürat Kargo"},{value:"HOROZMP",label:"Horoz Lojistik"},{value:"DHLECOMMP",label:"DHL"},{value:"PTTMP",label:"PTT"},{value:"CEVAMP",label:"Ceva"},{value:"TEXMP",label:"Trendyol Express"},{value:"KOLAYGELSINMP",label:"Kolay Gelsin"}],orderStatuses:[{key:null,label:"Tümü",count:0},{key:"CREATED",label:"Oluşturuldu",count:0},{key:"SHIPPED",label:"Taşıma Durumunda",count:0},{key:"PICKING",label:"İşleme Alındı",count:0},{key:"DELIVERED",label:"Teslim Edildi",count:0},{key:"INVOICED",label:"Faturalandı",count:0},{key:"CANCELLED",label:"İptal Edildi",count:0},{key:"UNDELIVERED",label:"Teslim Edilemedi",count:0},{key:"RETURNED",label:"İade Edildi",count:0},{key:"UNSUPPLIED",label:"Temin Edilmemiş",count:0},{key:"AWAITING",label:"Bekleniyor",count:0},{key:"UNPACKED",label:"Pakete Çıktı",count:0},{key:"AT_COLLECTION_POINT",label:"Teslimat Noktasında",count:0},{key:"VERIFIED",label:"Doğrulandı",count:0}]}},computed:{totalPages(){return Math.ceil(this.filteredOrders.length/this.pageSize)||1},filteredOrders(){let s=this.orders;if(this.selectedStatus&&(s=s.filter(e=>e.originalStatus===this.selectedStatus)),this.searchQuery.trim()!==""){const e=this.searchQuery.toLowerCase();s=s.filter(a=>a.siparisNumarasi&&a.siparisNumarasi.toString().toLowerCase().includes(e)||a.musteriAdSoyad&&a.musteriAdSoyad.toLowerCase().includes(e)||a.urunAdi&&a.urunAdi.toLowerCase().includes(e))}return s},paginatedOrders(){const s=(this.currentPage-1)*this.pageSize;return this.filteredOrders.slice(s,s+this.pageSize)}},watch:{selectedStatus(){this.currentPage=1},searchQuery(){this.currentPage=1}},async mounted(){this.loadOrders()},beforeUnmount(){clearInterval(this.pollingInterval)},methods:{async loadOrders(s=null){try{this.isLoading=!0;let e=`/api/Siparisler/kullanici/${localStorage.getItem("kullanici_id")}?sort=desc`;s!==null&&(e+=`?durum=${s}`);const a=await h.get(e);this.orders=a.data.data,this.orders.forEach(m=>{m.originalStatus=m.durum?.toUpperCase()||"";const r={CREATED:"Oluşturuldu",SHIPPED:"Taşıma Durumunda",PICKING:"İşleme Alındı",DELIVERED:"Teslim Edildi",INVOICED:"Faturalandı",CANCELLED:"İptal Edildi",UNDELIVERED:"Teslim Edilemedi",RETURNED:"İade Edildi",UNSUPPLIED:"Temin Edilmemiş",AWAITING:"Bekleniyor",UNPACKED:"Pakete Çıktı",AT_COLLECTION_POINT:"Teslimat Noktasında",VERIFIED:"Doğrulandı"};m.durum=r[m.originalStatus]||m.originalStatus}),this.updateStatusCounts()}catch(e){console.error("Siparişler yüklenemedi",e)}finally{this.isLoading=!1}},updateStatusCounts(){this.orderStatuses.forEach(s=>s.count=0),this.orderStatuses[0].count=this.orders.length,this.orders.forEach(s=>{const e=this.orderStatuses.find(a=>a.key===s.originalStatus);e&&e.count++})},async updateShippingCompany(){if(!this.selectedShippingCompany||this.selectedOrders.length===0){alert("Lütfen en az bir sipariş seçin ve kargo firması belirleyin.");return}try{const s={OrderIds:this.selectedOrders.map(a=>a.toString()),ShippingCompany:this.selectedShippingCompany};(await h.post("/api/siparisler/toplu-kargo-degistir",s)).data.success?(this.successMessage="Kargo firması başarıyla güncellendi!",this.selectedOrders=[],this.selectedShippingCompany=null,this.loadOrders(this.selectedStatus),setTimeout(()=>{this.successMessage=""},3e3)):alert("Güncelleme başarısız!")}catch(s){console.error("Toplu kargo güncelleme hatası:",s),alert("Hata oluştu!")}},selectStatus(s){this.selectedStatus=s},async sendTelegram(s){try{(await h.post(`/api/entegrasyonlar/send-siparis-telegram/${s}`)).data.sent?(alert("Sipariş Mesaj olarak gönderildi!"),this.loadOrders(this.selectedStatus)):alert("Gönderilemedi.")}catch(e){console.error(e),alert("Hata oluştu.")}},formatMoney(s,e){return v(s,e)},formatOrderDate(s){const e=new Date(s);return e.setHours(e.getHours()-3),e.toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},async openDetailModal(s){this.selectedOrder=s,await L(),this.$refs.orderModal&&typeof this.$refs.orderModal.showModal=="function"&&this.$refs.orderModal.showModal()},toggleSelectAll(s){s.target.checked?this.selectedOrders=this.paginatedOrders.map(e=>e.id):this.selectedOrders=[]}}},X={class:"d-flex justify-content-between align-items-center mb-3"},Z={class:"d-flex gap-2 mb-3"},q=["value"],J=["disabled"],$={class:"d-flex flex-wrap gap-2 mb-3"},ee=["onClick"],te={key:0,class:"alert alert-success",role:"alert"},se={key:1,class:"text-center py-4"},le={key:2,class:"table-responsive"},re={class:"table dark:table-dark table-bordered table-hover"},ie={class:"table-light"},ae=["value"],ne={class:"text-center"},oe={key:0,class:"d-flex flex-wrap justify-content-center align-items-start gap-2"},de=["src"],ue={class:"mt-1 text-truncate",style:{"font-size":"0.75rem",width:"100px"}},ge={key:1},ce={class:"text-center"},me={key:0,class:"text-success"},pe=["onClick"],ye={class:"text-center"},be=["onClick"],he={key:0},fe={colspan:"8",class:"text-center py-4 text-secondary"},Se={key:3,class:"d-flex justify-content-center mt-3 gap-2"},ke=["disabled"],ve={class:"align-self-center"},Ee=["disabled"];function Ce(s,e,a,m,r,d){const u=x("SiparisDetayModal");return o(),n("div",null,[t("div",X,[e[7]||(e[7]=t("h2",null,"Trendyol Siparişleri",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.searchQuery=l),type:"text",class:"form-control w-25",placeholder:"Sipariş no, müşteri adı veya ürün adı ara..."},null,512),[[T,r.searchQuery]])]),t("div",Z,[f(t("select",{class:"form-select w-auto","onUpdate:modelValue":e[1]||(e[1]=l=>r.selectedShippingCompany=l)},[e[8]||(e[8]=t("option",{disabled:"",value:""},"Kargo Seç",-1)),(o(!0),n(p,null,y(r.cargoOptions,l=>(o(),n("option",{key:l.value,value:l.value},i(l.label),9,q))),128))],512),[[C,r.selectedShippingCompany]]),t("button",{class:"btn btn-success",disabled:!r.selectedShippingCompany||r.selectedOrders.length===0,onClick:e[2]||(e[2]=(...l)=>d.updateShippingCompany&&d.updateShippingCompany(...l))}," Kargo Firmasını Güncelle ",8,J)]),t("div",$,[(o(!0),n(p,null,y(r.orderStatuses,l=>(o(),n("button",{key:l.key,class:S(["btn d-flex align-items-center gap-2",{"btn-primary":r.selectedStatus===l.key,"btn-outline-secondary":r.selectedStatus!==l.key}]),onClick:c=>d.selectStatus(l.key)},[t("span",null,i(l.label),1),t("span",{class:S(["badge ms-1",{"bg-danger":l.count===0,"bg-success":l.count>0&&r.selectedStatus!==l.key}])},i(l.count),3)],10,ee))),128))]),r.successMessage?(o(),n("div",te,i(r.successMessage),1)):b("",!0),r.isLoading?(o(),n("div",se,[...e[9]||(e[9]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-2 text-secondary"},"Siparişler yükleniyor...",-1)])])):(o(),n("div",le,[t("table",re,[t("thead",ie,[t("tr",null,[t("th",null,[t("input",{type:"checkbox",onChange:e[3]||(e[3]=l=>d.toggleSelectAll(l))},null,32)]),e[10]||(e[10]=t("th",null,"Ürün",-1)),e[11]||(e[11]=t("th",null,"Sipariş No",-1)),e[12]||(e[12]=t("th",null,"Müşteri Adı",-1)),e[13]||(e[13]=t("th",null,"Kargo Firması",-1)),e[14]||(e[14]=t("th",null,"Durum",-1)),e[15]||(e[15]=t("th",null,"Tarih",-1)),e[16]||(e[16]=t("th",null,"Toplam",-1)),e[17]||(e[17]=t("th",{class:"text-center"},"Mesaj Durumu",-1)),e[18]||(e[18]=t("th",{class:"text-center"},"#",-1))])]),t("tbody",null,[(o(!0),n(p,null,y(d.paginatedOrders,l=>(o(),n("tr",{key:l.id},[t("td",null,[f(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[4]||(e[4]=c=>r.selectedOrders=c)},null,8,ae),[[O,r.selectedOrders]])]),t("td",ne,[l.siparisUrunleri&&l.siparisUrunleri.length>0?(o(),n("div",oe,[(o(!0),n(p,null,y(l.siparisUrunleri,(c,k)=>(o(),n("div",{key:k,class:"d-flex flex-column align-items-center",style:{width:"100px"}},[t("img",{src:c.urun?.image,alt:"Ürün Resmi",style:{height:"90px","object-fit":"contain","border-radius":"6px",border:"1px solid #ddd"}},null,8,de),t("div",ue,i(c.urun?.ad),1)]))),128))])):(o(),n("div",ge,"—"))]),t("td",null,i(l.siparisNumarasi),1),t("td",null,i(l.musteriAdSoyad),1),t("td",null,i(r.cargoOptions.find(c=>c.value===l.cargoProviderName)?.label||l.cargoProviderName||"—"),1),t("td",null,[t("span",{class:S(["badge",{"bg-success":l.originalStatus==="DELIVERED","bg-primary":l.originalStatus==="SHIPPED","bg-warning text-dark":["CREATED","AWAITING"].includes(l.originalStatus),"bg-danger":l.originalStatus==="CANCELLED","bg-secondary":!["DELIVERED","SHIPPED","CREATED","AWAITING","CANCELLED"].includes(l.originalStatus)}])},i(l.durum),3)]),t("td",null,i(d.formatOrderDate(l.createdAt)),1),t("td",null,i(l.siparisUrunleri.reduce((c,k)=>c+k.toplam_Fiyat,0).toFixed(2)),1),t("td",ce,[l.telegramSent?(o(),n("span",me,[...e[19]||(e[19]=[t("i",{class:"bi bi-check-circle-fill"},null,-1)])])):(o(),n("button",{key:1,class:"btn btn-primary btn-sm",onClick:c=>d.sendTelegram(l.id)}," Gönder ",8,pe))]),t("td",ye,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:c=>d.openDetailModal(l)},[...e[20]||(e[20]=[t("i",{class:"bi bi-eye"},null,-1)])],8,be)])]))),128))]),d.paginatedOrders.length<1?(o(),n("tfoot",he,[t("tr",null,[t("td",fe,[e[21]||(e[21]=t("i",{class:"fas fa-inbox fs-1 mb-2"},null,-1)),t("p",null,i(r.selectedStatus?"Bu durumda sipariş bulunmuyor":"Henüz sipariş yok"),1)])])])):b("",!0)])])),!r.isLoading&&d.paginatedOrders.length>0?(o(),n("div",Se,[t("button",{class:"btn btn-outline-secondary",disabled:r.currentPage===1,onClick:e[5]||(e[5]=l=>r.currentPage--)},[...e[22]||(e[22]=[t("i",{class:"fas fa-chevron-left me-1"},null,-1),g(" Önceki ",-1)])],8,ke),t("span",ve," Sayfa "+i(r.currentPage)+" / "+i(d.totalPages)+" ("+i(d.filteredOrders.length)+" sipariş) ",1),t("button",{class:"btn btn-outline-secondary",disabled:r.currentPage===d.totalPages,onClick:e[6]||(e[6]=l=>r.currentPage++)},[...e[23]||(e[23]=[g(" Sonraki ",-1),t("i",{class:"fas fa-chevron-right ms-1"},null,-1)])],8,Ee)])):b("",!0),D(u,{ref:"orderModal",order:r.selectedOrder},null,8,["order"])])}const xe=E(W,[["render",Ce],["__scopeId","data-v-d162ca9f"]]);export{xe as default};
