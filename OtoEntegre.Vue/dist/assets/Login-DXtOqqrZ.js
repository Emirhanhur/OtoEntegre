import{_ as g,c as d,b as o,a as m,t as b,bE as w,j as u,k as h,bD as y,n as k,d as c,e as v,w as _,f as I,g as x,o as p}from"./index-BFPoeHg0.js";class l extends Error{}l.prototype.name="InvalidTokenError";function S(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,a)=>{let r=a.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function C(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return S(e)}catch{return atob(e)}}function E(t,e){if(typeof t!="string")throw new l("Invalid token specified: must be a string");e||(e={});const a=e.header===!0?0:1,r=t.split(".")[a];if(typeof r!="string")throw new l(`Invalid token specified: missing part #${a+1}`);let s;try{s=C(r)}catch(n){throw new l(`Invalid token specified: invalid base64 for part #${a+1} (${n.message})`)}try{return JSON.parse(s)}catch(n){throw new l(`Invalid token specified: invalid json for part #${a+1} (${n.message})`)}}const D={data(){return{email:"",password:"",error:"",loading:!1,showPassword:!1}},methods:{async login(){this.error="",this.loading=!0;try{const t=await x.post("api/auth/login",{email:this.email,password:this.password}),e=t.data.token;localStorage.setItem("token",e),localStorage.setItem("bayi_id",t.data.user.tedarik_Kullanici_Id),localStorage.setItem("kullanici_id",t.data.user.id),localStorage.setItem("telegram_chat",t.data.user.telegram_Chat),localStorage.setItem("telegram_token",t.data.user.telegram_Token);let r=E(e).role;r?Array.isArray(r)&&(r=r[0]):console.warn("JWT içinde rol bulunamadı!"),localStorage.setItem("rol",r),this.$router.push("/dashboard")}catch(t){t.response&&t.response.status===401?this.error="Email veya şifre yanlış!":this.error="Sunucu hatası, lütfen tekrar deneyin."}finally{this.loading=!1}}}},T={class:"d-flex justify-content-center align-items-center vh-100 bg-light"},U={class:"card p-4 shadow-sm",style:{width:"400px"}},V={key:0,class:"alert alert-danger"},N={class:"mb-3"},P={class:"mb-3"},j={class:"input-group"},A=["type"],B=["disabled"],M={key:0,class:"spinner-border spinner-border-sm me-2"},q={class:"text-center mt-3 text-muted"};function z(t,e,a,r,s,n){const f=I("router-link");return p(),d("div",T,[o("div",U,[e[9]||(e[9]=o("h3",{class:"card-title text-center mb-4"},"Giriş Yap",-1)),s.error?(p(),d("div",V,b(s.error),1)):m("",!0),o("form",{onSubmit:e[3]||(e[3]=w((...i)=>n.login&&n.login(...i),["prevent"]))},[o("div",N,[e[4]||(e[4]=o("label",{for:"email",class:"form-label"},"Email",-1)),u(o("input",{type:"email",id:"email",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=i=>s.email=i),required:""},null,512),[[h,s.email]])]),o("div",P,[e[5]||(e[5]=o("label",{for:"password",class:"form-label"},"Şifre",-1)),o("div",j,[u(o("input",{type:s.showPassword?"text":"password",id:"password",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=i=>s.password=i),required:""},null,8,A),[[y,s.password]]),o("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=i=>s.showPassword=!s.showPassword)},[o("i",{class:k(s.showPassword?"bi bi-eye-slash":"bi bi-eye")},null,2)])])]),o("button",{type:"submit",class:"btn btn-primary w-100",disabled:s.loading},[s.loading?(p(),d("span",M)):m("",!0),e[6]||(e[6]=c(" Giriş ",-1))],8,B)],32),o("p",q,[e[8]||(e[8]=c(" Hesabınız yok mu? ",-1)),v(f,{to:"/pages/register"},{default:_(()=>[...e[7]||(e[7]=[c("Kayıt Ol",-1)])]),_:1})])])])}const J=g(D,[["render",z]]);export{J as default};
