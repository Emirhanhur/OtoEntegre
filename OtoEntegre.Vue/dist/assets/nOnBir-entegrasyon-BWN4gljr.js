import{f as m}from"./format-nzxwg-s_.js";import"./bootstrap.esm-CQSEgM1I.js";import{_ as y,c as n,b as s,j as p,k as E,F as g,r as S,l as f,g as d,o,n as u,t as c}from"./index-BFPoeHg0.js";const k={data(){return{orders:[],selectedStatus:null,currentPage:1,pageSize:10,isLoading:!1,selectedOrder:null,searchQuery:"",orderStatuses:[{key:null,label:"Tümü",count:0},{key:"CREATED",label:"Oluşturuldu",count:0},{key:"SHIPPED",label:"Taşıma Durumunda",count:0},{key:"PICKING",label:"İşleme Alındı",count:0},{key:"DELIVERED",label:"Teslim Edildi",count:0},{key:"INVOICED",label:"Faturalandı",count:0},{key:"CANCELLED",label:"İptal Edildi",count:0},{key:"UNDELIVERED",label:"Teslim Edilemedi",count:0},{key:"RETURNED",label:"İade Edildi",count:0},{key:"UNSUPPLIED",label:"Temin Edilmemiş",count:0},{key:"AWAITING",label:"Bekleniyor",count:0},{key:"UNPACKED",label:"Pakete Çıktı",count:0},{key:"AT_COLLECTION_POINT",label:"Teslimat Noktasında",count:0},{key:"VERIFIED",label:"Doğrulandı",count:0}]}},computed:{totalPages(){return Math.ceil(this.filteredOrders.length/this.pageSize)||1},filteredOrders(){let t=this.orders;if(this.selectedStatus&&(t=t.filter(e=>e.originalStatus===this.selectedStatus)),this.searchQuery.trim()!==""){const e=this.searchQuery.toLowerCase();t=t.filter(r=>r.siparisNumarasi&&r.siparisNumarasi.toString().toLowerCase().includes(e)||r.musteriAdSoyad&&r.musteriAdSoyad.toLowerCase().includes(e)||r.urunAdi&&r.urunAdi.toLowerCase().includes(e))}return t},paginatedOrders(){const t=(this.currentPage-1)*this.pageSize;return this.filteredOrders.slice(t,t+this.pageSize)}},watch:{selectedStatus(){this.currentPage=1},searchQuery(){this.currentPage=1}},async mounted(){this.loadOrders()},beforeUnmount(){clearInterval(this.pollingInterval)},methods:{async loadOrders(t=null){try{this.isLoading=!0;let e="/api/siparisler?sort=desc";t!==null&&(e+=`?durum=${t}`);const r=await d.get(e);this.orders=r.data,this.orders.forEach(i=>{i.originalStatus=i.durum?.toUpperCase()||"";const l={CREATED:"Oluşturuldu",SHIPPED:"Taşıma Durumunda",PICKING:"İşleme Alındı",DELIVERED:"Teslim Edildi",INVOICED:"Faturalandı",CANCELLED:"İptal Edildi",UNDELIVERED:"Teslim Edilemedi",RETURNED:"İade Edildi",UNSUPPLIED:"Temin Edilmemiş",AWAITING:"Bekleniyor",UNPACKED:"Pakete Çıktı",AT_COLLECTION_POINT:"Teslimat Noktasında",VERIFIED:"Doğrulandı"};i.durum=l[i.originalStatus]||i.originalStatus}),this.updateStatusCounts()}catch(e){console.error("Siparişler yüklenemedi",e)}finally{this.isLoading=!1}},updateStatusCounts(){this.orderStatuses.forEach(t=>t.count=0),this.orderStatuses[0].count=this.orders.length,this.orders.forEach(t=>{const e=this.orderStatuses.find(r=>r.key===t.originalStatus);e&&e.count++})},selectStatus(t){this.selectedStatus=t},async sendTelegram(t){try{(await d.post(`/api/entegrasyonlar/send-siparis-telegram/${t}`)).data.sent?(alert("Sipariş Mesaj olarak gönderildi!"),this.loadOrders(this.selectedStatus)):alert("Gönderilemedi.")}catch(e){console.error(e),alert("Hata oluştu.")}},formatMoney(t,e){return m(t,e)},formatOrderDate(t){const e=new Date(t);return e.setHours(e.getHours()-3),e.toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},async openDetailModal(t){this.selectedOrder=t,await f(),this.$refs.orderModal&&typeof this.$refs.orderModal.showModal=="function"&&this.$refs.orderModal.showModal()}}},b={class:"d-flex justify-content-between align-items-center mb-3"},D={class:"d-flex flex-wrap gap-2 mb-3"},I=["onClick"],T={key:0,class:"text-center py-4"},C={key:1,class:"table-responsive"};function N(t,e,r,i,l,h){return o(),n("div",null,[s("div",b,[e[1]||(e[1]=s("h2",null,"Hepsi Burada Siparişleri",-1)),p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchQuery=a),type:"text",class:"form-control w-25",placeholder:"Sipariş no, müşteri adı veya ürün adı ara..."},null,512),[[E,l.searchQuery]])]),s("div",D,[(o(!0),n(g,null,S(l.orderStatuses,a=>(o(),n("button",{key:a.key,class:u(["btn d-flex align-items-center gap-2",{"btn-primary":l.selectedStatus===a.key,"btn-outline-secondary":l.selectedStatus!==a.key}]),onClick:L=>h.selectStatus(a.key)},[s("span",null,c(a.label),1),s("span",{class:u(["badge ms-1",{"bg-danger":a.count===0,"bg-success":a.count>0&&l.selectedStatus!==a.key}])},c(a.count),3)],10,I))),128))]),l.isLoading?(o(),n("div",T,[...e[2]||(e[2]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),s("p",{class:"mt-2 text-secondary"},"Siparişler yükleniyor...",-1)])])):(o(),n("div",C,[...e[3]||(e[3]=[s("table",{class:"table table-bordered table-hover"},[s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"Sıra No"),s("th",null,"Sipariş No"),s("th",null,"Müşteri Adı"),s("th",null,"Durum"),s("th",null,"Tarih"),s("th",null,"Toplam"),s("th",{class:"text-center"},"Mesaj Durumu"),s("th",{class:"text-center"},"#")])])],-1)])]))])}const v=y(k,[["render",N]]);export{v as default};
